[buildout]
testserver-parts =
    testserver
    testserver-selftest

parts += ${:testserver-parts}


[testserver]
recipe = zc.recipe.egg
eggs =
    ${test:eggs}
    plone.app.robotframework
scripts = robot-server=testserver
initialization =
    import os
    os.environ.setdefault('SABLON_BIN', '${buildout:sablon-executable}')
    os.environ.setdefault('ZSERVER_PORT', '55001')
    os.environ.setdefault('LISTENER_PORT', os.environ.get('TESTSERVER_CTL_PORT', '55002'))
    os.environ.setdefault('FTW_STRUCTLOG_MUTE_SETUP_ERRORS', 'true')
    import sys
    sys.argv.insert(1, 'opengever.core.testserver.OPENGEVER_TESTSERVER')
    print 'Plone:  http://localhost:{}/plone'.format(os.environ.get('ZSERVER_PORT'))
    print 'XMLRPC: http://localhost:{}'.format(os.environ.get('LISTENER_PORT'))


[testserver-selftest]
recipe = zc.recipe.egg:scripts
eggs = opengever.core[tests]
entry-points = testserver-selftest=opengever.core.testserver_selftest:selftest
scripts = testserver-selftest
