<div class="response-adder"
     i18n:domain="opengever.task">
    <h2 tal:condition="viewlet/responses" i18n:translate="responses">Responses:</h2>
    <tal:responses repeat="response_info viewlet/responses">
        <div class="response-reply"
             tal:define="id response_info/id;
                         response nocall:response_info/response;
                         html response_info/html;"
             tal:attributes="class string:response-${response/type}">
            <div class="response-actions"
                 tal:condition="viewlet/can_edit_response|viewlet/can_delete_response">
                <form method="post"
                      tal:attributes="action string:@@task_response_edit"
                      tal:condition="viewlet/can_edit_response">
                    <input type="hidden" name="response_id" tal:attributes="value id" />
                    <input class="standalone"
                           type="submit"
                           i18n:attributes="value"
                           value="Edit"
                           />
                </form>
                <form method="post"
                      tal:attributes="action string:@@task_response_delete"
                      tal:condition="viewlet/can_delete_response">
                    <input type="hidden" name="response_id" tal:attributes="value id" />
                    <input class="destructive"
                           type="submit"
                           i18n:attributes="value"
                           value="Delete"
                           />
                </form>
            </div>

            <div class="response-info">
                <span i18n:translate="task_added_by" class="label">Added by</span>
                <span class="contact-user"
                      tal:content="structure response/creator_link" />
                <span i18n:translate="task_added_on">on</span>
                <span class="contact-user"
                      tal:content="python:here.toLocalizedTime(response.date, long_format=True)" />
                <div tal:repeat="delta response/changes">
                    <span i18n:translate="" tal:content="string:${delta/name}" class="label"/>
                    <span class="issueChange"
                          i18n:translate=""
                          i18n:domain="plone"
                          tal:content="structure python: viewlet.convert_change_values(delta['id'], delta['before'])" />
                    &rarr;
                    <span class="issueChange"
                          i18n:translate=""
                          i18n:domain="plone"
                          tal:content="structure python: viewlet.convert_change_values(delta['id'], delta['after'])" />
                </div>

                <div tal:define="added_obj python:viewlet.get_added_object(response)"
                     tal:condition="nocall:added_obj">
                    <span i18n:translate="task_object_add" class="label">Added</span>
                    <span class="issueChange">
                        <img tal:attributes="src added_obj/getIcon" />
                        <a href=""
                           tal:attributes="href added_obj/absolute_url|nothing"
                           tal:omit-tag="not: added_obj/absolute_url|nothing">
                        <span tal:content="added_obj/Title" /></a>
                    </span>
                </div>

                <div tal:define="item python:viewlet.get_added_successor(response)"
                     tal:condition="nocall:item">
                    <span i18n:translate="task_object_successor" class="label">
                        Added successor task
                    </span>
                    <span class="issueChange"
                          tal:content="structure python:view.render_indexed_task(item)" />
                </div>

            </div>
            <span tal:replace="structure html" />


        </div>
    </tal:responses>
</div>
