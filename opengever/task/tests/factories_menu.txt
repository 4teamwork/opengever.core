Factories menu
==============

If a task is added to another task, it is called subtask. So we need
to change the name of the task in the add-menu if we are in a task.

import, roles ect.

    >>> from plone.app.testing import TEST_USER_NAME, setRoles
    >>> setRoles(self.portal, TEST_USER_NAME, ['Reviewer', 'Manager'])


Let the task be implicitly addable:

    >>> self.portal.portal_types['opengever.task.task'].global_allow = True


Lets get the browser menu:

    >>> from zope.app.publisher.interfaces.browser import IBrowserMenu
    >>> from zope.component import getUtility

    >>> menu = getUtility(IBrowserMenu,
    ...                   name='plone_contentmenu_factory',
    ...                   context=self.portal)

    >>> menu
    <ftw.contentmenu.menu.FactoriesMenu object at ...>


In the folder the task should be addable as "Task" since we have made it
implicitly addable:

    >>> items = menu.getMenuItems(self.folder, self.app.REQUEST)
    >>> titles = [item['title'] for item in items]
    >>> u'Task' in titles
    True
    >>> u'Subtask' in titles
    False


Let's create a task within the folder:

    >>> from plone.dexterity.utils import createContentInContainer
    >>> task = createContentInContainer(self.folder, 'opengever.task.task',
    ...                                 checkConstraints=False,
    ...                                 title='Task one',
    ...                                 issuer=TEST_USER_NAME,
    ...                                 responsible=TEST_USER_NAME,)

    >>> wft = task.portal_workflow
    >>> wft.doActionFor(task, 'task-transition-open-in-progress')


Check the addables:
    >>> items = menu.getMenuItems(task, self.app.REQUEST)
    >>> titles = [item['title'] for item in items]
    >>> u'Task' in titles
    False
    >>> u'Subtask' in titles
    True
