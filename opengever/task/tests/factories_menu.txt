Factories menu
==============

If a task is added to another task, it is called subtask. So we need
to change the name of the task in the add-menu if we are in a task.

import, roles ect.

	>>> portal = layer['portal']
	>>> app = layer['app']
	>>> request = layer['request']
    >>> from plone.app.testing import TEST_USER_ID, setRoles
    >>> setRoles(portal, TEST_USER_ID, ['Reviewer', 'Manager'])

Let the task be implicitly addable:
    >>> portal.portal_types['opengever.task.task'].global_allow = True


Lets get the browser menu:

    >>> from zope.app.publisher.interfaces.browser import IBrowserMenu
    >>> from zope.component import getUtility

    >>> menu = getUtility(IBrowserMenu,
    ...                   name='ftw_contentmenu_factory',
    ...                   context=portal)

    >>> menu
	 <ftw.contentmenu.menu.FactoriesMenu object at ...>


In the folder the task should be addable as "Task" since we have made it
implicitly addable:

    >>> items = menu.getMenuItems(portal, request)
    >>> titles = [item['title'] for item in items]
    >>> u'Task' in titles
    True
    >>> u'Subtask' in titles
    False


Let's create a task within the folder:

    >>> from plone.dexterity.utils import createContentInContainer
    >>> task = createContentInContainer(portal, 'opengever.task.task',
    ...                                 checkConstraints=False,
    ...                                 title='Task one',
    ...                                 issuer=TEST_USER_ID,
    ...                                 responsible=TEST_USER_ID,)

    >>> wft = task.portal_workflow
    >>> wft.doActionFor(task, 'task-transition-open-in-progress')


Check the addables:
    >>> items = menu.getMenuItems(task, request)
    >>> titles = [item['title'] for item in items]
    >>> u'Task' in titles
    False
    >>> u'Subtask' in titles
    True
