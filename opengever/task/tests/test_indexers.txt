Check the indexers of a task
============================

imports and standard stuff:

    >>> from opengever.task.task import related_items
    >>> from plone.app.testing import TEST_USER_ID
    >>> from plone.dexterity.utils import createContentInContainer
    >>> from z3c.relationfield.relation import RelationValue
    >>> from zope.component import getUtility
    >>> from zope.intid.interfaces import IIntIds
    >>> import datetime

    >>> intids = getUtility(IIntIds)
    >>> portal = layer['portal']


related_items indexer
---------------------

Create three documents to test related_items indexer:

    >>> doc1 = createContentInContainer(portal, 'opengever.document.document', title=u"Doc One")
    >>> doc1
    <Document at /plone/document-1>
    >>> doc1_intid = intids.getId(doc1)

    >>> doc2 = createContentInContainer(portal, 'opengever.document.document', title=u"Doc Two")
    >>> doc2
    <Document at /plone/document-2>
    >>> doc2_intid = intids.getId(doc2)

    >>> doc3 = createContentInContainer(portal, 'opengever.document.document', title=u"Doc Three")
    >>> doc3
    <Document at /plone/document-3>

Create two tasks, each referencing a different document, and check the indexer returns the correct relations:

    >>> task1 = createContentInContainer(portal, 'opengever.task.task',
    ...     issuer=TEST_USER_ID, responsible=TEST_USER_ID, relatedItems=[RelationValue(doc1_intid)])
    >>> task1
    <Task ...>
    >>> related_items.callable(task1) == [doc1_intid]
    True

    >>> task2 = createContentInContainer(portal, 'opengever.task.task',
    ...     issuer=TEST_USER_ID, responsible=TEST_USER_ID, relatedItems=[RelationValue(doc2_intid)])
    >>> task2
    <Task ...>
    >>> related_items.callable(task2) == [doc2_intid]
    True

Create a third task with NO related items:

    >>> task3 = createContentInContainer(portal, 'opengever.task.task',
    ...     issuer=TEST_USER_ID, responsible=TEST_USER_ID)
    >>> task3
    <Task ...>
    >>> related_items.callable(task3) == []
    True





