<html xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      tal:omit-tag="python: True">

    <tal:i18n i18n:domain="opengever.task" tal:define="groups view/boxes; css_width python:99/len(groups)">
  <div tal:repeat="boxes groups" tal:attributes="class string:boxGroup boxGroup${repeat/boxes/index}; style string:width:${css_width}%">
    <div tal:repeat="box boxes" class="box" tal:attributes="id string:${box/id}Box">
	
	
      <h2 i18n:translate=""
		tal:condition="box/content" tal:content="box/label|box/id"></h2>

      <tal:box tal:condition="python: not hasattr(box.get('content'), '__iter__')">
        <tal:item  tal:condition="box/content">
          <span tal:content="box/content" />
        </tal:item>
        <tal:item tal:condition="not: box/content">
          <span i18n:translate="no_content" />
        </tal:item>
      </tal:box>

      <tal:box tal:condition="python: hasattr(box.get('content'), '__iter__')">
        <tal:items define="items box/content">
          <ul tal:condition="items">
            <li tal:repeat="item items">

              <!-- item is a widget (used for the addition box) -->
              <tal:brain tal:condition="python: view.get_type(item) == 'widget'">
                <!-- item is a widget -->
                <tal:cond tal:condition="item/label">
                  <span tal:content="structure item/label" />
                  <span>: </span>
                  <span tal:content="structure item/render" />
                </tal:cond>
                <tal:cond tal:condition="not: item/label">
                  <span tal:content="structure item/render" />
                </tal:cond>
              </tal:brain>

              <!-- item is a brain -->
              <tal:brain tal:condition="python: view.get_type(item) == 'brain'">
				<span tal:attributes="class python:'wf-%s' % item.review_state">
                <a href="" tal:attributes="href item/getURL|nothing;
                                           title item/alt|nothing;
                                           class python:view.get_css_class(item)" tal:omit-tag="not: item/getURL|nothing">
                <span tal:content="item/Title" /></a>
				</span>
              </tal:brain>

              <!-- item is a dict (Documents and participants) -->
              <tal:dict tal:condition="python: view.get_type(item) == 'dict'">
                <a href=""
                   tal:attributes="href item/getURL|nothing;
                                   title item/alt|nothing;
                                   class python:'rollover-breadcrumb %s' % (item.get('css_class'))"
                   tal:omit-tag="not: item/getURL|nothing">

                	<span tal:condition="item/getURL|nothing" tal:content="item/Title" />
                	<span tal:condition="not: item/getURL|nothing"
						  tal:content="item/Title"
						  tal:attributes="class python:'rollover-breadcrumb %s' % (item.get('css_class'))" />

			   </a>
              </tal:dict>

              <!-- SQLAlchemy Objects (Tasks from GlobalIndex)-->
              <tal:sql tal:condition="python: view.get_type(item) == 'sqlalchemy_object'">
				<span tal:attributes="class python:'wf-%s' % item.review_state">
                <div tal:replace="structure python:view.render_globalindex_task(item)" />
				</span>
              </tal:sql>
            </li>
          </ul>
          <span tal:condition="not: items" i18n:translate="no_content" />
        </tal:items>
      </tal:box>

    </div>
  </div>

<!-- 

        <table class="vertical invisible task-listing">
            <tal:rep tal:define="group python: view.groups[0]">

                <tr>
                    <th tal:content="python: group.widgets['text'].label" />
                    <td tal:content="structure python: group.widgets['text'].render()" />
                </tr>

                <tr tal:condition="python: 'task_type' in group.widgets">
                    <th tal:content="python: group.widgets['task_type'].label" />
                    <td tal:content="structure python: group.widgets['task_type'].render()" />
                </tr>

                <tr>
                    <th i18n:domain="opengever.task" i18n:translate="label_workflow_state">State</th>
                    <td i18n:domain="plone">
                        <span tal:define="wfstate python:context.portal_workflow.getInfoFor(view.context, 'review_state')"
                              tal:attributes="class string:wf-${wfstate}"
                              i18n:translate=""
                              tal:content="wfstate">
                        </span>
                    </td>
                </tr>

                <tr>
                    <th tal:content="python: group.widgets['issuer'].label"></th>
                    <td tal:content="structure view/issuer_link" />
                </tr>

                <tr>
                    <th i18n:domain="opengever.task" i18n:translate="label_responsible">Responsible</th>
                    <td tal:content="structure view/responsible_link" />
                </tr>

                <tr tal:condition="context/deadline">
                    <th tal:content="python:group.widgets['deadline'].label"></th>
                    <td tal:content="python:context.deadline.strftime('%d.%m.%Y')"/>
                </tr>

                <tr tal:condition="python: context.expectedStartOfWork">
                    <th tal:content="python: view.groups[1].widgets['expectedStartOfWork'].label"></th>
                    <td tal:content="python:context.expectedStartOfWork.strftime('%d.%m.%Y')"/>
                </tr>

                <tr>
                    <th i18n:domain="opengever.task" i18n:translate="label_last_modified">Last change</th>
                    <td tal:content="python: view.context.modified().strftime('%d.%m.%Y %H:%M')"/>
                </tr>
                <tr><td></td></tr>

            </tal:rep>


            <tal:rep2 tal:define="group2 python: len(view.groups) > 1 and view.groups[1] or None"
                      tal:condition="python: len(view.groups) > 1">

                <tr tal:repeat="widget group2/widgets/values">
                    <tal:block condition="python:widget.__name__ not in ('IBasic.title', 'IBasic.description', 'title',
                                          'description', 'expectedStartOfWork', 'date_of_completion') and widget.value and widget.value != ('', '', '')">
                        <th tal:content="structure widget/label" />
                        <td tal:content="structure widget/render" />
                    </tal:block>
                    <tal:block condition="python: widget.__name__=='date_of_completion' and widget.value">
                        <th tal:content="structure widget/label" />
                        <td tal:content="python: context.date_of_completion.strftime('%d.%m.%Y')" />
                    </tal:block>
                </tr>

            </tal:rep2>

        </table>

        <div class="visualClear"></div>

        <tal:items define="items view/getContainingTask"
                   condition="items">
            <div tal:condition="items"><h2 i18n:translate="containing_task">Containing Task:</h2></div>
            <ul tal:condition="items">
                <li tal:repeat="item items">
                    <span tal:attributes="class string:wf-${item/@@plone_context_state/workflow_state}" />
                    <a tal:attributes="href item/absolute_url|nothing;
                                       class python: view.css_class_from_brain(item)"
                       tal:omit-tag="not: item/absolute_url|nothing"><span tal:content="item/Title" /></a>
                </li>
            </ul>
        </tal:items>

        <tal:items define="items view/getSubTasks"
                   condition="items">
            <div tal:condition="items"><h2 i18n:translate="subtasks">Subtasks:</h2></div>
            <ul tal:condition="items">
                <li tal:repeat="item items">
                    <span tal:attributes="class string:wf-${item/@@plone_context_state/workflow_state}" />
                    <a tal:attributes="href item/absolute_url|nothing;
                                       class python: view.css_class_from_brain(item)"
                       tal:omit-tag="not: item/absolute_url|nothing">
                       <span tal:content="item/Title" />
                       <span class="discreet">
                           (<tal:reponsible replace="python:view.subtask_responsible(item)" />)
                       </span>
                   </a>
               </li>
           </ul>
       </tal:items> -->

        <!-- <tal:items define="item view/getPredecessorTask"
                   condition="item">
            <div tal:condition="item"><h2 i18n:translate="predecessor">Predecessor Task:</h2></div>
            <div tal:content="structure python:view.render_indexed_task(item)"
                 tal:attributes="class string:wf-${item/review_state}"/>
        </tal:items>

        <tal:items define="items view/getSuccessorTasks"
                   condition="items">
            <div><h2 i18n:translate="successors">Successor Tasks:</h2></div>
            <ul tal:condition="items">
                <li tal:repeat="item items"
                    tal:content="structure python:view.render_indexed_task(item)"
                    tal:attributes="class string:wf-${item/review_state}"/>
            </ul>
        </tal:items> -->



        <div class="visualClear"><!----></div>
        <div tal:replace="structure provider:opengever.task.beneathTask" />
        <div class="visualClear"><!----></div>
        <div tal:replace="structure provider:plone.belowcontentbody" />
        <div class="visualClear"><!----></div>
    </tal:i18n>

</html>
