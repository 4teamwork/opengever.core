<html xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      tal:omit-tag="python: True">

    <tal:i18n i18n:domain="opengever.task">
        <table class="vertical invisible task-listing">
            <tal:rep tal:define="group python: view.groups[0]">

                <tr>
                    <th tal:content="python: group.widgets['text'].label" />
                    <td tal:content="structure python: group.widgets['text'].render()" />
                </tr>

                <tr tal:condition="python: 'task_type' in group.widgets">
                    <th tal:content="python: group.widgets['task_type'].label" />
                    <td tal:content="structure python: group.widgets['task_type'].render()" />
                </tr>

                <tr>
                    <th i18n:domain="opengever.task" i18n:translate="label_workflow_state">State</th>
                    <td i18n:domain="plone">
                        <span tal:define="wfstate python:context.portal_workflow.getInfoFor(view.context, 'review_state')"
                              tal:attributes="class string:wf-${wfstate}"
                              i18n:translate=""
                              tal:content="wfstate">
                        </span>
                    </td>
                </tr>

                <tr>
                    <th tal:content="python: group.widgets['issuer'].label"></th>
                    <td tal:content="structure view/issuer_link" />
                </tr>

                <tr>
                    <th i18n:domain="opengever.task" i18n:translate="label_responsible">Responsible</th>
                    <td tal:content="structure view/responsible_link" />
                </tr>

                <tr tal:condition="context/deadline">
                    <th tal:content="python:group.widgets['deadline'].label"></th>
                    <td tal:content="python:context.deadline.strftime('%d.%m.%Y')"/>
                </tr>

                <tr tal:condition="python: context.expectedStartOfWork">
                    <th tal:content="python: view.groups[1].widgets['expectedStartOfWork'].label"></th>
                    <td tal:content="python:context.expectedStartOfWork.strftime('%d.%m.%Y')"/>
                </tr>

                <tr>
                    <th i18n:domain="opengever.task" i18n:translate="label_last_modified">Last change</th>
                    <td tal:content="python: view.context.modified().strftime('%d.%m.%Y %H:%M')"/>
                </tr>
                <tr><td></td></tr>

            </tal:rep>


            <tal:rep2 tal:define="group2 python: len(view.groups) > 1 and view.groups[1] or None"
                      tal:condition="python: len(view.groups) > 1">

                <tr tal:repeat="widget group2/widgets/values">
                    <tal:block condition="python:widget.__name__ not in ('IBasic.title', 'IBasic.description', 'title',
                                          'description', 'expectedStartOfWork', 'date_of_completion') and widget.value and widget.value != ('', '', '')">
                        <th tal:content="structure widget/label" />
                        <td tal:content="structure widget/render" />
                    </tal:block>
                    <tal:block condition="python: widget.__name__=='date_of_completion' and widget.value">
                        <th tal:content="structure widget/label" />
                        <td tal:content="python: context.date_of_completion.strftime('%d.%m.%Y')" />
                    </tal:block>
                </tr>

            </tal:rep2>

        </table>

        <div class="visualClear"><!----></div>

        <tal:items define="items view/getContainingTask"
                   condition="items">
            <div tal:condition="items"><h2 i18n:translate="containing_task">Containing Task:</h2></div>
            <ul tal:condition="items">
                <li tal:repeat="item items">
                    <a href="" tal:attributes="href item/absolute_url|nothing; class python: view.css_class_from_brain(item)" tal:omit-tag="not: item/absolute_url|nothing"><span tal:content="item/Title" /></a>
                </li>
            </ul>
        </tal:items>

        <tal:items define="items view/getSubTasks"
                   condition="items">
            <div tal:condition="items"><h2 i18n:translate="subtasks">Subtasks:</h2></div>
            <ul tal:condition="items">
                <li tal:repeat="item items">
                    <a href="" class="contenttype-opengever-task-task" tal:attributes="href item/getURL|nothing; class python: view.css_class_from_brain(item)" tal:omit-tag="not: item/getURL|nothing"><span tal:content="item/Title" /></a>
                </li>
            </ul>
        </tal:items>

        <tal:items define="item view/getPredecessorTask"
                   condition="item">
            <div tal:condition="item"><h2 i18n:translate="predecessor">Predecessor Task:</h2></div>
            <div tal:content="structure python:view.render_indexed_task(item)" />
        </tal:items>

        <tal:items define="items view/getSuccessorTasks"
                   condition="items">
            <div><h2 i18n:translate="successors">Successor Tasks:</h2></div>
            <ul tal:condition="items">
                <li tal:repeat="item items"
                    tal:content="structure python:view.render_indexed_task(item)" />
            </ul>
        </tal:items>
        <div class="visualClear"><!----></div>
        <div tal:replace="structure provider:opengever.task.beneathTask" />
        <div class="visualClear"><!----></div>
        <div tal:replace="structure provider:plone.belowcontentbody" />
        <div class="visualClear"><!----></div>
    </tal:i18n>

</html>
