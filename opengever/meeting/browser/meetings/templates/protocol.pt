<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" xmlns:tal="http://xml.zope.org/namespaces/tal" xmlns:metal="http://xml.zope.org/namespaces/metal" xmlns:i18n="http://xml.zope.org/namespaces/i18n" metal:use-macro="here/main_template/macros/master" lang="en" i18n:domain="opengever.meeting">
<metal:content-core fill-slot="content-core">
  <metal:content-core define-macro="content-core" tal:define="meeting view/model;
                                    agenda_items python: list(view.get_agenda_items(include_paragraphs=True));">
    <div id="opengever_meeting_protocol">
      <metal:use use-macro="context/@@ploneform-macros/titlelessform">
        <metal:block fill-slot="fields">
          <div class="protocol-navigation"
               tal:attributes="data-meeting meeting/meeting_id;
                               data-modified meeting/modified">
            <div class="list-group">
              <div id="protocol-controls" class="list-group-item submit actions">
                <div class="button-group fluid">
                  <metal:use use-macro="context/@@ploneform-macros/actions" />
                  <input type="submit" id="button-value-discard" value="Discard" i18n:attributes="value" />
                </div>
                <div id="changes-hint" class="spv-label warning">
                  <i></i>
                  <span i18n:translate="label_unsaved_changes">You have unsaved changes</span>
                </div>
              </div>
              <div class="list-group-item navigation">
                <ul class="nav">
                  <li tal:repeat="protocol agenda_items"
                      tal:attributes="class python: 'expandable ' + protocol.get_css_class()">
                    <metal:block tal:define="name protocol/name">
                      <a tal:attributes="href string:#${name};
                                         id string:${name}-anchor;
                                         class python: 'expandable ' + protocol.get_css_class()">
                        <span class="number" tal:content="python: protocol.number"></span>
                        <span class="title" tal:content="python: protocol.get_title()"></span>
                      </a>
                      <ul class="nav">
                        <metal:block tal:repeat="field view/agenda_item_fields">
                          <metal:block tal:define="field_name field/name">
                            <li>
                              <a tal:attributes="href string:#${name}-${field_name};
                                                 id string:${name}-${field_name}-anchor"
                                 tal:content="field/label">
                              </a>
                            </li>
                          </metal:block>
                        </metal:block>
                      </ul>
                    </metal:block>
                  </li>
                </ul>
              </div><!-- Navigation -->
            </div><!-- List group -->
          </div><!-- Protocol navigation -->
          <div class="right">
            <div class="collapsible">
              <div class="collapsible-header">
                <button class="button fa fa-plus"></button>
                <span class="label" i18n:translate="">Meetinginformation</span>
              </div>
              <div class="collapsible-content">
                <metal:use use-macro="context/@@ploneform-macros/fields" />
              </div>
            </div>
            <div class="agenda_items">
              <label id="dummy"></label>
              <metal:block tal:repeat="protocol agenda_items">
                <div tal:define="name protocol/name" class="item">
                  <h2 tal:attributes="id name;
                                      class python: 'protocol_title ' + protocol.get_css_class()">
                    <span class="heading">
                      <span class="number"
                            tal:content="python: protocol.number"></span>
                      <span class="title">
                        <span class="text"
                              tal:content="python: protocol.get_title()"></span>
                        <span class="dossier_reference_number"
                              tal:content="protocol/get_dossier_reference_number"></span>
                      </span>
                    </span>
                  </h2>
                  <metal:block tal:repeat="field view/agenda_item_fields">
                    <metal:block tal:define="field_name field/name">
                      <label tal:attributes="for string:${name}-${field_name};
                                             id string:${name}-${field_name}-label"
                             tal:content="field/label"></label>
                      <input type="text"
                             class="trix-input"
                             tal:attributes="name string:${name}.${field_name}:record;
                                             id string:${name}-${field_name};
                                             value python:getattr(protocol, field_name)" />
                      <trix-toolbar tal:attributes="id string:${name}-${field_name}-toolbar">
                        <div class="button-group">
                            <button type="button" class="button bold" data-attribute="bold"></button>
                            <button type="button" class="button italic" data-attribute="italic"></button>
                        </div>
                        <div class="button-group">
                          <button type="button" class="button bullet" data-attribute="bullet"></button>
                          <button type="button" class="button number" data-attribute="number"></button>
                        </div>
                        <div class="button-group">
                          <button type="button" class="button increaseBlockLevel" data-action="increaseBlockLevel"></button>
                          <button type="button" class="button decreaseBlockLevel" data-action="decreaseBlockLevel"></button>
                        </div>
                        <div class="button-group">
                          <button type="button" class="button undo" data-action="undo"></button>
                          <button type="button" class="button redo" data-action="redo"></button>
                        </div>
                      </trix-toolbar>
                      <trix-editor autofocus toolbar="toolbar"
                                   tal:define="autofocus repeat/field/start"
                                   tal:attributes="toolbar string:${name}-${field_name}-toolbar;
                                                   input string:${name}-${field_name};
                                                   autofocus python: '' if autofocus else nothing"
                                   tal:content="structure python:getattr(protocol, field_name)" />
                    </metal:block>
                  </metal:block>
                </div>
              </metal:block>
            </div>
          </div>
          <metal:use use-macro="context/@@meeting-macros/disable_kss_inline_validation" />
        </metal:block>
        <!-- Prevent rendering form actions by inserting empty content -->
        <metal:block fill-slot="actions"></metal:block>
      </metal:use>
    </div>
  </metal:content-core>
</metal:content-core>

</html>
