<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="opengever.meeting">

  <metal:title metal:fill-slot="content-title">
    <div id="tabbedview-header">
      <h1 class="memberHeading documentFirstHeading" tal:content="view/model/get_title" />
    </div>
  </metal:title>

  <metal:content-core fill-slot="content-core">
      <metal:content-core define-macro="content-core"
                          tal:define="meeting view/model;
                                      unscheduled_proposals view/unscheduled_proposals">
      <div id="opengever_meeting_meeting"
           tal:attributes="data-unexpected-error view/msg_unexpected_error;
                           data-update-agenda-item-order-url view/url_update_agenda_item_order;
                           data-list-agenda-items-url view/url_list_agenda_items
                           data-list-unscheduled-proposals-url view/url_list_unscheduled_proposals">

        <div class="sidebar">
          <div class="list-group metadata">
            <div class="list-group-item submit">
              <div class="button-group fluid">
                <a class="button" tal:attributes="href view/url_protocol" i18n:translate="">Edit</a>
                <metal:use use-macro="context/@@meeting-macros/workflow_actions" />
              </div>
            </div>
            <div class="list-group-item">
              <dl>
                <dt tal:attributes="class python: 'workflow_state ' + meeting. workflow_state"></dt>
                <dd tal:content="meeting/workflow_state"></dd>

                <dt id="meeting_location"></dt>
                <dd tal:content="meeting/location"></dd>

                <dt id="meeting_time"></dt>
                <dd>
                  <span tal:replace="python: meeting.get_start_time()"></span>
                  -
                  <span tal:replace="python: meeting.get_end_time()"></span>
                </dd>

                <dt id="meeting_presidency"
                    tal:condition="meeting/presidency"></dt>
                <dd tal:condition="meeting/presidency"
                    tal:content="meeting/presidency/fullname"></dd>

                <dt id="meeting_secretary"
                    tal:condition="meeting/secretary"></dt>
                <dd tal:condition="meeting/secretary"
                    tal:content="meeting/secretary/fullname"></dd>

                <dt id="meeting_participants"></dt>
                <dd>
                  <ul>
                    <li tal:repeat="participant meeting/participants"
                        tal:content="participant/fullname"></li>
                  </ul>
                </dd>

                <dt id="related_dossier"></dt>
                <dd>
                  <a tal:attributes="href meeting/get_dossier_url"
                     tal:content="python: meeting.get_dossier().title"></a>
                </dd>
              </dl>
            </div>
            <div class="list-group-item protocol"
                 tal:define="protocol_document view/get_protocol_document">
              <h2 i18n:translate="">Protocol</h2>
              <a tal:condition="protocol_document"
                 tal:attributes="href protocol_document/absolute_url; class python: view.get_css_class(protocol_document)"
                 tal:content="protocol_document/Title"></a>
              <div class="button_group">
                <a class="button" tal:attributes="href view/url_generate_protocol" i18n:translate="">Generate</a>
                <a class="button" tal:condition="protocol_document" tal:attributes="href view/url_download_protocol" i18n:translate="">Download preview</a>
              </div>
            </div>
            <div class="list-group-item" tal:define="excerpts view/manually_generated_excerpts">
              <h2 i18n:translate="">Excerpts</h2>
              <ul class="excerpts">
                <li tal:repeat="item excerpts">
                  <a href="" tal:attributes="href item/absolute_url;
                                             class python:view.get_css_class(item)">
                    <span class="document" tal:condition="item/absolute_url" tal:content="item/Title" />
                  </a>
                </li>
              </ul>
              <a class="button" tal:attributes="href view/url_manually_generate_excerpt" i18n:translate="">Generate excerpt</a>
            </div>
          </div>

        </div>
        <div class="content">
          <div class="collapsible open">
            <div class="collapsible-header">
              <button class="button fa fa-plus"></button>
              <h2 class="label" i18n:translate="">Agenda Items</h2>
            </div>
            <div class="collapsible-content open">
              <form method="post" tal:attributes="action view/url_schedule_text">
                <div class="input-group">
                  <label for="title">Freitext:</label>
                  <input id="title" name="title" type="text" />
                  <div class="button-group">
                    <input type="submit"
                           name="schedule-paragraph"
                           id="submit-schedule-paragraph"
                           value="as paragraph"
                           i18n:attributes="value" />
                    <input type="submit"
                           name="schedule-text"
                           id="submit-schedule-text"
                           value="as free-text"
                           i18n:attributes="value" />
                  </div>
                </div>
              </form>
              <label>Antr√§ge:</label>
              <div class="list-group">
                <tal:repeat tal:repeat="proposal unscheduled_proposals">
                  <div class="list-group-item submit"
                       tal:attributes="id proposal/proposal_id;
                                       value proposal/proposal_id">
                    <span class="title"
                          tal:content="proposal/title"></span>
                    <div class="button-group">
                      <a class="button add-proposal"
                         i18n:translate="schedule"
                         tal:attributes="href python: view.url_schedule_proposal(proposal)"></a>
                    </div>
                  </div>
                </tal:repeat>
              </div>
            </div>
          </div>

          <table id="agenda_items">
            <thead>
              <tr>
                <th>Sort</th>
                <th>Number</th>
                <th>Title</th>
                <th>Documents</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <script id="agendaitemsTemplate" type="text/x-handlebars-template">
                  {{#each agendaitems}}
                    <tr class="{{css_class}}" data-uid={{id}}>
                      <td class="sortable-handle"></td>
                      <td class="number">{{number}}</td>
                      <td class="title">
                        {{{link}}}
                        {{#if has_proposal}}
                          <ul class="attachements">
                            {{#each documents}}
                              <li>
                                <a href={{link}} class="{{css_class}}">{{title}}</a>
                              </li>
                            {{/each}}
                          </ul>
                        {{/if}}
                        {{#if excerpt}}
                          <div class="summary">
                            <a href="{{excerpt.link}}" class="{{excerpt.css_class}}">{{excerpt.title}}</a>
                          </div>
                        {{/if}}
                      </td>
                      <td class="toggle-attachements">
                        {{#if documents}}
                          <a class="toggle-attachements-btn"></a>
                        {{/if}}
                      </td>
                      <td class="actions">
                        <div class="button-group">
                          <a href="{{edit_link}}" class="button edit-agenda-item"></a>
                          <a href="{{delete_link}}" class="button delete-agenda-item"></a>
                        </div>
                      </td>
                    </tr>
                  {{/each}}
              </script>
            </tbody>
          </table>
        </div>
        <div class="visualClear"><!----></div>
      </div>

    </metal:content-core>
  </metal:content-core>

</html>
