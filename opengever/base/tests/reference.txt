Reference Behavior
================

The reference number Behavior show a integer field (reference Number), the reference number field.
The behavior set the default value to the next possible sequence number.

When we create a dexterity content type::

    >>> from opengever.base.behaviors import creator
    >>> from plone.dexterity.fti import DexterityFTI
    >>> fti = DexterityFTI('TestingType')
    >>> fti.behaviors = (
    ...                  'opengever.base.behaviors.reference.IReferenceNumber',
    ...                  )
    >>> self.portal.portal_types._setObject('TestingType', fti)
    'TestingType'
    >>> schema = fti.lookupSchema()


If we access the site as an admin TTW::

    >>> from Products.Five.testbrowser import Browser
    >>> browser = Browser()
    >>> browser.handleErrors = False
    >>> self.app.acl_users.userFolderAddUser('root', 'secret',
    ...                                      ['Manager'], [])
    >>> browser.addHeader('Authorization', 'Basic root:secret')


We can see this type in the addable types at the root of the site::

    >>> browser.open('http://nohost/plone/folder_factories')
    >>> 'TestingType' in browser.contents
    True
    >>> browser.getControl('TestingType').click()
    >>> browser.getControl('Add').click()
    >>> browser.url
    'http://nohost/plone/++add++TestingType'
    >>> 'reference_number' in browser.contents
    True
    >>> browser.getControl(name='form.widgets.IReferenceNumber.reference_number').value
    '1'
    >>> browser.getControl('Save').click()
    >>> browser.url
    'http://nohost/plone/TestingType/view'
    
checked the saved obj ::
    >>> obj = self.portal.testingtype
    >>> obj
    <Item at ...>
    >>> obj.reference_number
    1
    
Add a second Type in this folder::
    >>> browser.open('http://nohost/plone/folder_factories')
    >>> 'TestingType' in browser.contents
    >>> browser.getControl('TestingType').click()
    >>> browser.getControl('Add').click()
    >>> browser.url
    'http://nohost/plone/++add++TestingType'
    >>> 'reference_number' in browser.contents
    True
    >>> browser.getControl(name='form.widgets.IReferenceNumber.reference_number').value == 2
    True
    >>> browser.getControl(name='form.widgets.IReferenceNumber.reference_number').value = '1'
    >>> browser.getControl('Save').click()
    >>> browser.url
    'http://nohost/plone/++add++TestingType'
