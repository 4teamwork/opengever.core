<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="opengever.contact">

  <metal:title metal:fill-slot="content-title">
    <div id="tabbedview-header">
      <h1 class="documentFirstHeading" tal:content="view/model/fullname" />
    </div>
  </metal:title>

  <metal:content-core fill-slot="content-core">
    <metal:content-core define-macro="content-core"
                        tal:define="person view/model;">

      <h3 i18n:translate="label_personal_information">Personal information:</h3>
      <table class="contact_details">
        <tr>
          <th i18n:translate="label_name">Name</th>
          <td tal:content="person/fullname" />
        </tr>
        <tr>
          <th i18n:translate="label_salutation">Salutation</th>
          <td tal:content="person/salutation" />
        </tr>
        <tr>
          <th i18n:translate="label_academic_title">Academic title</th>
          <td tal:content="person/academic_title" />
        </tr>

        <tr>
          <th i18n:translate="label_addresses">Addresses</th>
          <td>
            <dl class="address">
              <tal:repeat tal:repeat="address person/addresses">
                <dt tal:content="address/label" />
                <dd>
                  <span class="street" tal:content="address/street" />
                  <br />
                  <span tal:content="address/zip_code" />
                  <span tal:content="address/city" />
                </dd>
              </tal:repeat>
            </dl>
          </td>
        </tr>

        <tr>
          <th i18n:translate="label_mail">Mail Addresses</th>
          <td>
            <dl class="mail">
              <tal:repeat tal:repeat="mail person/mail_addresses">
                <dt tal:content="mail/label" />
                <dd>
                  <span tal:content="mail/address" />
                </dd>
              </tal:repeat>
            </dl>
          </td>
        </tr>

        <tr>
          <th i18n:translate="label_phone_numbers">Phone numbers</th>
          <td>
            <dl class="phone_number">
              <tal:repeat tal:repeat="phone person/phonenumbers">
                <dt tal:content="phone/label" />
                <dd>
                  <span tal:content="phone/phone_number" />
                </dd>
              </tal:repeat>
            </dl>
          </td>
        </tr>

        <tr>
          <th i18n:translate="label_urls">URLs</th>
          <td>
            <dl class="url">
              <tal:repeat tal:repeat="url person/urls">
                <dt tal:content="url/label" />
                <dd>
                  <span tal:content="url/url" />
                </dd>
              </tal:repeat>
            </dl>
          </td>
        </tr>

      </table>

      <h3 i18n:translate="label_organizations">Organizations</h3>
      <ul class="organizations orgrole_listing">
        <li tal:repeat="org_role view/get_org_roles">
          <span class="name">
            <a href="#"
               tal:attributes="href org_role/organization/get_url"
               tal:content="org_role/organization/name" />
          </span>
          <span class="function" tal:content="org_role/function" />
        </li>
      </ul>

      <h3 i18n:translate="label_latest_participations">Latest participations</h3>
      <ul class="person dossier_listing" id="latest_participation_listing"
          tal:attributes="data-fetch-url view/participations_fetch_url">

        <img tal:attributes="src string:${portal_url}/spinner.gif" class="spinner"/>

        <script id="latest_participations_template" type="text/x-handlebars-template">
          {{#if has_more}}
          <a href="" id="participation_show_all" i18n:translate="label_show_all">Show all</a>
          {{/if}}
          {{#each participations}}
          <li>
            <span class="name">
              <a class="dossier" href="{{url}}">{{title}}</a>
            </span>
            <ul class="roles function" >
              {{#each roles}}
              <li>
                <span>{{label}}</span>
              </li>
              {{/each}}
            </ul>
          </li>
          {{/each}}
        </script>
      </ul>

      <div class="collapsible" id="contactHistory">
        <div class="collapsible-header">
          <button class="button fa fa-plus"></button>
          <span class="label" i18n:translate="label_archived_persons">Archived Personal Information</span>
        </div>
        <div class="collapsible-content">

      <table class="contact_details">
        <tal:block tal:repeat="archived_person person/archived_contacts">
          <tr>
            <td colspan="2" class="archivedBy">
              <span tal:content="structure python: view.get_actor_link(archived_person)"></span>
              <time class="timeago" tal:attributes="datetime archived_person/created"></time>
            </td>
          </tr>
          <tr>
            <th i18n:translate="label_name">Name</th>
            <td tal:content="archived_person/fullname" />
          </tr>
          <tr>
            <th i18n:translate="label_salutation">Salutation</th>
            <td tal:content="archived_person/salutation" />
          </tr>
          <tr>
            <th i18n:translate="label_academic_title">Academic title</th>
            <td tal:content="archived_person/academic_title" />
          </tr>
        </tal:block>

        <tr tal:condition="person/archived_addresses">
          <th i18n:translate="label_archived_addresses">Archived Addresses</th>
          <td>
            <dl class="address">
              <tal:repeat tal:repeat="archived_address person/archived_addresses">
                <div class="archivedBy">
                  <span tal:content="structure python: view.get_actor_link(archived_address)" />
                  <time class="timeago" tal:attributes="datetime archived_address/created" />
                </div>
                <dt tal:content="archived_address/label" />
                <dd>
                  <span class="street" tal:content="archived_address/street" />
                  <br />
                  <span tal:content="archived_address/zip_code" />
                  <span tal:content="archived_address/city" />
                </dd>
              </tal:repeat>
            </dl>
          </td>
        </tr>

        <tr tal:condition="person/archived_mail_addresses">
          <th i18n:translate="label_archived_mail">Archived Mail Addresses</th>
          <td>
            <dl class="mail">
              <tal:repeat tal:repeat="archived_mail person/archived_mail_addresses">
                <div class="archivedBy">
                  <span tal:content="structure python: view.get_actor_link(archived_mail)" />
                  <time class="timeago" tal:attributes="datetime archived_mail/created" />
                </div>
                <dt tal:content="archived_mail/label" />
                <dd>
                  <span tal:content="archived_mail/address" />
                </dd>
              </tal:repeat>
            </dl>
          </td>
        </tr>

        <tr tal:condition="person/archived_phonenumbers">
          <th i18n:translate="label_archived_phone_numbers">Archived Phone Numbers</th>
          <td>
            <dl class="phone_number">
              <tal:repeat tal:repeat="archived_phone person/archived_phonenumbers">
                <div class="archivedBy">
                  <span tal:content="structure python: view.get_actor_link(archived_phone)" />
                  <time class="timeago" tal:attributes="datetime archived_phone/created" />
                </div>
                <dt tal:content="archived_phone/label" />
                <dd>
                  <span tal:content="archived_phone/phone_number" />
                </dd>
              </tal:repeat>
            </dl>
          </td>
        </tr>

      </table>
      </div>

    </metal:content-core>
  </metal:content-core>

</html>
