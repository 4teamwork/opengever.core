Contact
======= 

Helpers:


do some imports and configurations
    >>> from plone.testing.z2 import Browser
    >>> from plone.app.testing import TEST_USER_NAME
    >>> from plone.app.testing import TEST_USER_PASSWORD
    >>> from plone.app.testing import setRoles
    >>> from plone.dexterity.utils import createContentInContainer
    >>> from Products.CMFCore.utils import getToolByName

    >>> app = layer['app']
    >>> portal = layer['portal']

browser test
    >>> browser = Browser(app)
    >>> browser.handleErrors = False

    >>> browser.open(portal.absolute_url() + '/login_form')
    >>> browser.getControl(name='__ac_name').value = TEST_USER_NAME
    >>> browser.getControl(name='__ac_password').value = TEST_USER_PASSWORD
    >>> browser.getControl(name='submit').click()

    >>> browser.open(portal.portal_url())
    >>> 'test_user_1' in browser.contents
    True

create contact folder

    >>> browser.open('http://nohost/plone/folder_factories')
    >>> browser.getControl('ContactFolder').click()
    >>> browser.getControl('Add').click()
    >>> browser.url
    'http://nohost/plone/++add++opengever.contact.contactfolder'
    
    >>> browser.getControl('Title').value='Foobar'
    >>> browser.getControl('Description').value='Lorem Ipsum'
    >>> browser.getControl('Save').click()

test view:
----------

create a contact:

    >>> browser.open('http://nohost/plone/opengever.contact.contactfolder/folder_factories')
    >>> browser.getControl('Contact').click()
    >>> browser.getControl('Add').click()

    >>> browser.url
    'http://nohost/plone/opengever.contact.contactfolder/++add++opengever.contact.contact'
    >>> browser.getControl('Firstname').value = 'lorem'
    >>> browser.getControl('Save').click()

    >>> browser.url
    'http://nohost/plone/opengever.contact.contactfolder/++add++opengever.contact.contact'
    >>> browser.getControl('Firstname').value = 'Hanspeter'
    >>> browser.getControl('Lastname').value = 'Walter'
    >>> browser.getControl('Description').value = 'Lorem ipsum, bla bla'
    >>> browser.getControl('Save').click()
    >>> browser.url
    'http://nohost/plone/opengever.contact.contactfolder/opengever.contact.contact/view'
    

test searchabelText indexing
----------------------------

helper:

    >>> def obj2brain(obj):
    ...     catalog = getToolByName(obj, 'portal_catalog')
    ...     query = {'path': {'query': '/'.join(obj.getPhysicalPath()),
    ...                       'depth': 0}}
    ...     brains = catalog(query)
    ...     if len(brains) == 0:
    ...         raise Exception('Not in catalog: %s' % obj)
    ...     else:
    ...         return brains[0]

    >>> def getSearchableText(obj):
    ...     brain = obj2brain(obj)
    ...     catalog = getToolByName(obj, 'portal_catalog')
    ...     data = catalog.getIndexDataForRID(brain.getRID())
    ...     return data['SearchableText']

    >>> obj = portal.get(
    ...     'opengever.contact.contactfolder').get(
    ...         'opengever.contact.contact')
    >>> getSearchableText(obj)
    ['walter', 'hanspeter']
