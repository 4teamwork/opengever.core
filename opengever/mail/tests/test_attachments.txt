Imports
    >>> from Products.Five.testbrowser import Browser
    >>> from Products.PloneTestCase.setup import portal_owner, default_password
    >>> from plone.dexterity.interfaces import IDexterityFTI
    >>> from plone.dexterity.utils import createContentInContainer
    >>> from zope.component import getUtility
    >>> from zope.schema import getFields

    >>> self.setRoles(['Editor', 'Contributor', 'Owner'])

Create content
    >>> fti = getUtility(IDexterityFTI, name='ftw.mail.mail')
    >>> schema = fti.lookupSchema()
    >>> field_type = getFields(schema)['message']._type
    >>> msgtxt = 'Mime-Version: 1.0\nContent-Type: multipart/mixed; boundary=908752978\nTo: to@example.org\nFrom: from@example.org\nSubject: Attachment Test\nDate: Thu, 01 Jan 1970 01:00:00 +0100\nMessage-Id: <1>\n\n\n--908752978\nContent-Disposition: attachment;\n	filename*=iso-8859-1''B%FCcher.txt\nContent-Type: text/plain;\n	name="=?iso-8859-1?Q?B=FCcher.txt?="\nContent-Transfer-Encoding: base64\n\nw6TDtsOcCg==\n\n--908752978--\n'

    >>> dossier = createContentInContainer(
    ...     self.folder, 'opengever.dossier.businesscasedossier', title=u'Dossier 1')

    >>> mail1 = createContentInContainer(dossier, 'ftw.mail.mail',
    ...     message=field_type(data=msgtxt,
    ...          contentType=u'message/rfc822', filename=u'attachment.txt'))

    >>> mail2 = createContentInContainer(
    ...     dossier, 'ftw.mail.mail', title=u'Mail 1')

Browser & login
    >>> browser = Browser()
    >>> browser.handleErrors = False
    >>> browser.open('%s/login_form' % self.portal.absolute_url())
    >>> browser.getControl(name='__ac_name').value = portal_owner
    >>> browser.getControl(name='__ac_password').value = default_password
    >>> browser.getControl(name='submit').click()

No attachments
    >>> browser.open('%s/extract_attachments' % mail2.absolute_url())
    >>> browser.url == mail2.absolute_url()
    True

Cancel
    >>> browser.open('%s/extract_attachments' % mail1.absolute_url())
    >>> browser.getControl(name='form.cancelled').click()
    >>> browser.url == mail1.absolute_url()
    True

Submit
    >>> browser.open('%s/extract_attachments' % mail1.absolute_url())
    >>> browser.getControl(name='form.submitted').click()
    >>> 'You have not selected any attachments' in browser.contents
    True
    >>> browser.getControl(name='attachments:list').value=[1]
    >>> browser.getControl(name='form.submitted').click()
    >>> 'Created document BÃ¼cher' in browser.contents
    True

Delete attachments from message
    >>> browser.open('%s/extract_attachments' % mail1.absolute_url())
    >>> browser.getControl(name='attachments:list').value=[1]
    >>> browser.getControl(name='delete_action').value=['all']
    >>> browser.getControl(name='form.submitted').click()
    >>> from ftw.mail.utils import get_attachments
    >>> len(get_attachments(mail1.msg)) == 0
    True

