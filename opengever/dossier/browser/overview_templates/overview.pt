<!--TODO: refactor using viewlets-->
<tal:block i18n:domain="opengever.dossier"
           tal:define="groups view/boxes; css_width python:99/3">

  <div class="boxGroup boxGroup0" tal:attributes="style string:width:${css_width}%">
    <div class="box" id="subdossiersBox">
      <h2 i18n:translate="">Dossier structure</h2>

      <tal:block tal:condition="view/is_subdossier_navigation_available">
        <div id="dossier-tree"
             tal:attributes="data-dossier-navigation-url view/navigation_json_url;
                             data-context-url context_url;"
             tal:define="context_url context/absolute_url">
          <ul class="filetree">
            <img src="spinner.gif" class="spinner"/>
          </ul>
        </div>

        <script type="text/javascript"
          tal:define="navroot context/@@plone_portal_state/navigation_root_url"
          tal:attributes="src string:${navroot}/++resource++opengever.dossier.resources/init_tree.js">
        </script>
      </tal:block>

      <tal:block tal:condition="not: view/is_subdossier_navigation_available">
        <span i18n:translate="" >No Subdossiers</span>
      </tal:block>

    </div>
  </div>

  <tal:block tal:repeat="boxes groups">
  <div tal:define="repeat_index repeat/boxes/index;
                   box_id python: repeat_index + 1;"
       tal:attributes="class string:boxGroup boxGroup${box_id};
                       style string:width:${css_width}%">
    <div tal:repeat="box boxes" class="box" tal:attributes="id string:${box/id}Box">
      <h2 i18n:translate="" tal:content="box/label|box/id"></h2>

      <tal:box tal:condition="python: not hasattr(box.get('content'), '__iter__')">
        <tal:item  tal:condition="box/content">
          <span tal:content="box/content" />
        </tal:item>
        <tal:item tal:condition="not: box/content">
          <span i18n:translate="no_content" />
        </tal:item>
      </tal:box>

      <tal:box tal:condition="python: hasattr(box.get('content'), '__iter__')">
        <tal:items define="items box/content">
          <ul tal:condition="items">
            <li tal:repeat="item items">

              <!-- item is a brain -->
              <tal:brain tal:condition="python: view.get_type(item) == 'brain'">
                <a href="" tal:attributes="href item/getURL|nothing;
                                           title item/alt|nothing;
                                           class python:view.get_css_class(item)" tal:omit-tag="not: item/getURL|nothing">
                <span tal:content="item/Title" /></a>
              </tal:brain>

              <!-- item is a dict (Documents and participants) -->
              <tal:dict tal:condition="python: view.get_type(item) == 'dict'">
                <a href=""
                   tal:attributes="href item/getURL|nothing;
                                   title item/alt|nothing;
                                   class python:'rollover-breadcrumb %s' % (item.get('css_class'))"
                   tal:omit-tag="not: item/getURL|nothing">
                <span tal:content="item/Title" /></a>
              </tal:dict>

              <!-- SQLAlchemy Objects (Tasks from GlobalIndex)-->
              <tal:sql tal:condition="python: view.get_type(item) == 'sqlalchemy_object'">
                <div tal:replace="structure python:view.render_globalindex_task(item)" />
              </tal:sql>
            </li>

            <li class="moreLink">
              <a
                  tal:attributes="href python: box.get('href', None) and '#%s' % box.get('href') or '#%s' % box.get('id')"
                  i18n:translate="">
              show all</a>
            </li>
          </ul>
          <span tal:condition="not: items" i18n:translate="no_content" />
        </tal:items>
      </tal:box>

    </div>
  </div>
  </tal:block>

</tal:block>
