<!--TODO: refactor using viewlets-->
<tal:block i18n:domain="opengever.dossier" tal:define="groups view/boxes">
    <div tal:repeat="boxes groups" tal:attributes="class string:boxGroup${repeat/boxes/index}">
        <div tal:repeat="box boxes" class="box" tal:attributes="id string:${box/id}Box">

            <h2 i18n:translate="" tal:content="box/label|box/id"></h2>

            <tal:items define="items box/content" tal:condition="python:box['id'] != 'description'">
                <ul tal:condition="items">
                    <li tal:repeat="item items">

                        <!-- Tasks from GlobalIndex are SQLAlchemy Objects-->
                        <tal:GLOBAL_INDEX_TASK tal:condition="python:box['id'] in ['assigned_tasks', 'inbox']">
                            <div tal:replace="structure python:view.render_globalindex_task(item)" />
                        </tal:GLOBAL_INDEX_TASK>

                        <!-- Documents are dictionaries -->
                        <tal:DOCUMENT tal:condition="python:box['id'] == 'documents'">
                            <a href="" tal:attributes="href item/getURL|nothing;
                                                       title item/alt|nothing;
                                                       class python:view.get_css_class(item)" tal:omit-tag="not: item/getURL|nothing">
                                                       <span tal:content="item/Title" /></a>
                        </tal:DOCUMENT>

                        <!-- Everything else we consider to be a brain -->
                        <tal:BRAIN tal:condition="python:box['id'] not in ['documents', 'assigned_tasks', 'inbox']">

                            <a href="" tal:attributes="href item/getURL|nothing;
                                                       title item/alt|nothing;
                                                       class python:view.get_css_class(item)" tal:omit-tag="not: item/getURL|nothing">
                                                       <span tal:content="item/Title" /></a>
                        </tal:BRAIN>

                    </li>

                    <li class="moreLink">
                        <a tal:attributes="href string:#${box/id}" i18n:translate="">show all</a>
                    </li>
                </ul>
                <span tal:condition="not: items" i18n:translate="no_content" />
            </tal:items>
            <tal:description define="items box/content" tal:condition="python: box['id'] == 'description'">
                <tal:items define="item items" tal:condition="items">
                    <span tal:content="item" />
                </tal:items>
            </tal:description>
        </div>
    </div>
</tal:block>
