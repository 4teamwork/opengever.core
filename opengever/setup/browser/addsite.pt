<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      i18n:domain="opengever.setup">

  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />

    <title i18n:translate="">Deploy OneGov GEVER</title>

    <link rel="stylesheet" type="text/css"
          href="/++resource++plone-admin-ui.css" />

    <script type="text/javascript" language="javascript"
            src="/++resource++opengever.setup-jquery.min.js">
    </script>

    <style type="text/css">
      #header {
        position: absolute;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 80px;
      }

      #logo {
        width: 35em;
        margin: 10px auto;
      }

      #separator {
        width: 99%;
        margin: auto auto;
        border-bottom: 5px solid #00616c;
      }

      h1 {
        margin-top: 100px;
      }

      #default_client_config_scheme {
        display: none;
      }

      .client_config {
        margin-bottom: 1em;
        border-bottom: 1px dotted grey;
      }

      dt {
        float: left;
        width: 10em;
        text-align: right;
        padding-right: 1em;
      }

      input[type=text] {
      width: 20em;
      }

      .complete {
        display: none;
      }

      .spinner {
        position: relative;
        top: -9em;
        left: 15em;
      }

      .policy_warnings li {
        color: red;
      }

      .dbinfo {
          font-size: 130%;
          margin-top: 0;
      }

      fieldset.config {
        width: 100%;
      }

      form {
        width: 50em;
      }

      .backlink {
        font-size: .9em;
      }

      body {
        color: #32444a;
      }
    </style>

    <script type="text/javascript" language="javascript"
            tal:content="string:var server_port = ${view/server_port};">
    </script>

    <script type="text/javascript" language="javascript"
            tal:attributes="src view/javascript_src_url">
    </script>

  </head>
  <body>

    <div id="header">
      <div id="logo">
        <img src="/++resource++onegovgever.jpeg" />
      </div>
      <div id="separator"></div>
    </div>

    <h1 i18n:translate="">Deploy OneGov GEVER</h1>

    <form action="#"
          method="post"
          tal:attributes="action string:${context/absolute_url}/@@opengever-create-client"
          tal:define="profiles view/profiles;
                      base_profiles profiles/base;
                      default_profile profiles/default;
                      extension_profiles profiles/extensions;
                      advanced request/advanced|nothing;">

      <fieldset class="config">
        <legend i18n:translate="">Installation configuration</legend>

        <div class="field">
          <label for="policy" i18n:translate="">Policy profile</label>
          <div class="formHelp"></div>
          <select name="policy">
            <option tal:repeat="item view/get_deployment_options"
                    tal:content="item"
                    tal:attributes="value item;
                                    selected python:'selected' if repeat['item'].index == 0 else ''">
            </option>
          </select>
        </div>

        <div class="field">
          <div>
              <strong>ZODB database configuration</strong>
              <pre class="dbinfo" tal:content="view/get_zodb_config"></pre>
          </div>

          <div>
              <strong>OGDS database configuration</strong>
              <pre class="dbinfo" tal:content="view/get_ogds_config"></pre>
          </div>
        </div>

        <div class="field" id="ldap_profile_selector">
          <label for="ldap" i18n:translate="">LDAP configuration profile</label>
          <div class="formHelp"></div>
          <select name="ldap">
            <option value="" i18n:translate="">- skip LDAP -</option>
            <option tal:repeat="item view/get_ldap_profiles"
                    tal:content="python:item[0]"
                    tal:attributes="value python:item[1];
                                    selected python:'selected' if repeat['item'].index == 0 else ''">
            </option>
          </select>
        </div>

        <div class="field">
          <label for="import_users" i18n:translate="">
            Import LDAP-users into OGDS
          </label>
          <div class="formHelp"></div>
          <input type="checkbox" name="import_users:boolean"
                 id="import_users"
                 tal:attributes="checked python:'checked' if view.is_development_mode else ''"/>
          <span i18n:translate="" class="import_users_label">
            Import users from LDAP into OGDS?
          </span>
        </div>

      </fieldset>
      <fieldset class="config">
        <legend i18n:translate="">Development options</legend>

        <div class="field">
          <label for="dev_mode" i18n:translate="">
            Development mode
          </label>
          <div class="formHelp"></div>
          <input type="checkbox" name="dev_mode:boolean"
                 id="dev_mode"
                 tal:attributes="checked python:'checked' if view.is_development_mode else ''"/>
          <span i18n:translate="" class="dev_mode_label">
            Use "og_demo-ftw_users" group for OrgUnits and local role configuration
          </span>
        </div>

        <div class="field">
          <label for="purge_sql" i18n:translate="">
            Purge SQL
          </label>
          <div class="formHelp"></div>
          <input type="checkbox" name="purge_sql:boolean"
                 id="purge_sql"
                 tal:attributes="checked python:'checked' if view.is_development_mode else ''"/>
          <span i18n:translate="" class="purge_sql_label">
            Purge SQL completely before setup
          </span>
        </div>

      </fieldset>


      <fieldset class="complete">
        <div>Installation completed.</div>
        <input type="button" class="open_first_client"
               value="Open first client" />
      </fieldset>


      <div class="formControls">
        <input type="hidden" name="form.submitted:boolean" value="True" />
        <input type="submit" name="submit" value="Setup opengever"
               i18n:attributes="value;" />
        <a class="backlink" href="/manage_main">back to Manage</a>
      </div>
    </form>
  </body>
</html>
